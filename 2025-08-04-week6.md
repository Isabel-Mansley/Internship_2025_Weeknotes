# Week 6 - 04 August 2025
Successfully created the New Zealand classification map for the North Island, due to being a much larger area than the Cairngorms this has been running in the background for a while.

A section of the New Zealand Classification:

![A section of the New Zealand map ](/images/week6/new-zealand-map.png)

One problem with the classification, particularly in areas where the model was less sure about the habitat type, was that there wouldnâ€™t be a cohesive polygon but instead a scattering of points. 

And sometimes one pixel would disrupt a large area of another habitat even when there is no major change in habitat there. To improve this a selective majority filter was applied to smooth the map. However; this risked loosing detail, for example a small pond that takes up one pixel in the middle of a forest. To overcome this, a confidence layer was generated alongside the map, and then the smoothing effect was only applied to low confidence pixels.
This should:

- Ensure that low confidence pixels, like a shadow that was mistook for water are merged into the habitat surrounding them
- High confidence but unique features are kept.

The original map highlighting how sporadic habitat classes can be:

![The original map with no smoothing](/images/week6/original-smoothed.png)

A smooth applied to all of the pixels:

![A map with all pixels being smoothed](/images/week6/fully-smoothed.png)

A smooth applied to pixels with a confidence below 0.5:

![A map with <0.5 confidence pixels being smoothed](/images/week6/0.5-smoothed.png)

A smooth applied to pixels with a confidence below 0.3:

![A map with <0.3 confidence pixels being smoothed](/images/week6/0.3-smoothed.png)

A smooth applied to pixels with a confidence below 0.2:

![A map with <0.2 confidence pixels being smoothed](/images/week6/0.2-smoothed.png)

One thing to note is that the confidence threshold can be tinkered with to improve accuracy. Crucially not every class has the same max confidence. Alpine heath has a max confidence of 29% whilst heath has a max confidence of 97%. This means that all alpine heath pixels will be smoothed under the current 0.5 threshold. It might be worth setting individual confidence limits to each class based on how confident the model is. 

A <0.5 confidence smoothing is almost indistinguishable from a full smooth, leading to only a few pixels of difference in a window at a time. Whereas <0.2 and <0.3 confidence gives some smoothing.

It will always be a compromise between eliminating interference and keeping detail; however, a map using smoothing of <0.2 or <0.3 confidence looks to be around right.

I also started looking at how the Cairngorms had changed overtime as TESSERA has embeddings from 2017 to 2024, more on this will be looked into next week!
